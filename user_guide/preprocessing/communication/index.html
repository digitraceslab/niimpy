

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Call and Message Data &mdash; Niimpy dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=3c2ae12a"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Screen On/Off Data" href="../screen/" />
    <link rel="prev" title="Battery Data" href="../battery/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../" class="icon icon-home">
            Niimpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/architecture/">Architecture and workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/schema/">Data schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/contribution_guide/">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/How-to-cite/">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about/see-also/">See also</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quick-start/">Quick start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../reading/">Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic-transformations/">Basic transformations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Preprocessing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../location/">Location Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application/">Application data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../audio/">Audio Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../battery/">Battery Data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Call and Message Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1.-Introduction">1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.-Read-data">2. Read data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#*-TIP!-Data-format-requirements-(or-what-should-our-data-look-like)">* TIP! Data format requirements (or what should our data look like)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.-Extracting-features">4. Extracting features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#4.1-Extract-features-using-stand-alone-functions">4.1 Extract features using stand-alone functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.2-Extract-features-using-the-wrapper">4.2 Extract features using the wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.3-SMS-computations">4.3 SMS computations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#*-TIP!-Data-format-requirements-for-SMS-(special-case)">* TIP! Data format requirements for SMS (special case)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#5.-Implementing-own-features">5. Implementing own features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../screen/">Screen On/Off Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../survey/">Survey Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracker/">Tracker Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Exploration/">Exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Analysis/">Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../demo/student_life_example/">Demo Notebook on Reading and Exploring the Studentlife Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../aware/">Aware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules/">niimpy API docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Niimpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../">Preprocessing</a></li>
      <li class="breadcrumb-item active">Call and Message Data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/user_guide/preprocessing/communication.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Call-and-Message-Data">
<h1>Call and Message Data<a class="headerlink" href="#Call-and-Message-Data" title="Link to this heading"></a></h1>
<section id="1.-Introduction">
<h2>1. Introduction<a class="headerlink" href="#1.-Introduction" title="Link to this heading"></a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>, communication data includes calls and SMS information. These data can reveal important information about people’s circadian rhythm, social patterns, and activity, just to mention a few. Therefore, it is important to organize this information for further processing and analysis. To address this, <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> includes a set of functions to clean, downsample, and extract features from communication data.</p>
<p>A communication data dataframe should include the following columns (column names can be different, but in that case they must be provided as parameters):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: Subject ID</p></li>
</ul>
<p>Required for calls:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">call_duration</span></code>: The duration of a call</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_type</span></code>: Type of a call, “incoming”, “outgoing” or “missed”</p></li>
</ul>
<p>Required for messages:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">message_type</span></code>: Type of a message, “incoming” or “outgoing”</p></li>
</ul>
<p>The available features are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">call_duration_total</span></code>: duration of incoming and outgoing calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_duration_mean</span></code>: mean duration of incoming and outgoing calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_duration_median</span></code>: median duration of incoming and outgoing calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_duration_std</span></code>: standard deviation of incoming and outgoing calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_count</span></code>: number of calls within a time window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call_outgoing_incoming_ratio</span></code>: number of outgoing calls divided by the number of incoming calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sms_count</span></code>: count of incoming and outgoing text messages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extract_features_comms</span></code>: wrapper to extract several features at the same time</p></li>
</ul>
<p>In the following, we will analyze call logs provided by <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> as an example to illustrate the use of niimpy’s communication preprocessing functions.</p>
</section>
<section id="2.-Read-data">
<h2>2. Read data<a class="headerlink" href="#2.-Read-data" title="Link to this heading"></a></h2>
<p>Let’s start by reading the example data provided in <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>. These data have already been shaped in a format that meets the requirements of the data schema. Let’s start by importing the needed modules. Firstly we will import the <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> package and then we will import the module we will use (communication) and give it a short name for use convinience.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">niimpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">niimpy.preprocessing.communication</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">com</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">niimpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/u/24/rantahj1/unix/miniconda3/envs/niimpy/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div></div>
</div>
<p>Now let’s read the example data provided in <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>. The example data is in <code class="docutils literal notranslate"><span class="pre">csv</span></code> format, so we need to use the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function. When reading the data, we can specify the timezone where the data was collected. This will help us handle daylight saving times easier. We can specify the timezone with the argument <strong>tz</strong>. The output is a dataframe. We can also check the number of rows and columns in the dataframe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">niimpy</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">MULTIUSER_AWARE_CALLS_PATH</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(38, 6)
</pre></div></div>
</div>
<p>The data was succesfully read. We can see that there are 38 datapoints with 6 columns in the dataset. However, we do not know yet what the data really looks like, so let’s have a quick look:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>call_type</th>
      <th>call_duration</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 02:08:03.895999908+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>incoming</td>
      <td>1079</td>
      <td>2020-01-09 02:08:03.895999908+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:49:44.969000101+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578531e+09</td>
      <td>outgoing</td>
      <td>174</td>
      <td>2020-01-09 02:49:44.969000101+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:22:57.168999910+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>outgoing</td>
      <td>890</td>
      <td>2020-01-09 02:22:57.168999910+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:27:21.187000036+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578530e+09</td>
      <td>outgoing</td>
      <td>1342</td>
      <td>2020-01-09 02:27:21.187000036+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:47:16.177000046+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578531e+09</td>
      <td>incoming</td>
      <td>645</td>
      <td>2020-01-09 02:47:16.177000046+02:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>call_type</th>
      <th>call_duration</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-12 22:10:21.503999949+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565637e+09</td>
      <td>incoming</td>
      <td>715</td>
      <td>2019-08-12 22:10:21.503999949+03:00</td>
    </tr>
    <tr>
      <th>2019-08-12 22:27:19.923000097+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565638e+09</td>
      <td>outgoing</td>
      <td>225</td>
      <td>2019-08-12 22:27:19.923000097+03:00</td>
    </tr>
    <tr>
      <th>2019-08-13 07:01:00.960999966+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565669e+09</td>
      <td>outgoing</td>
      <td>1231</td>
      <td>2019-08-13 07:01:00.960999966+03:00</td>
    </tr>
    <tr>
      <th>2019-08-13 07:28:27.657999992+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565671e+09</td>
      <td>incoming</td>
      <td>591</td>
      <td>2019-08-13 07:28:27.657999992+03:00</td>
    </tr>
    <tr>
      <th>2019-08-13 07:21:26.436000109+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565670e+09</td>
      <td>outgoing</td>
      <td>375</td>
      <td>2019-08-13 07:21:26.436000109+03:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>By exploring the head and tail of the dataframe we can form an idea of its entirety. From the data, we can see that:</p>
<ul class="simple">
<li><p>rows are observations, indexed by timestamps, i.e. each row represents a call that was received/done/missed at a given time and date</p></li>
<li><p>columns are characteristics for each observation, for example, the user whose data we are analyzing</p></li>
<li><p>there are at least two different users in the dataframe</p></li>
<li><p>there are two main columns: <code class="docutils literal notranslate"><span class="pre">call_type</span></code> and <code class="docutils literal notranslate"><span class="pre">call_duration</span></code>. In this case, the <code class="docutils literal notranslate"><span class="pre">call_type</span></code> columns stores information about whether the call was <em>incoming</em>, <em>outgoing</em> or <em>missed</em>; and the <code class="docutils literal notranslate"><span class="pre">call_duration</span></code> contains the duration of the call in seconds</p></li>
</ul>
<p>In fact, we can check the first three elements for each user</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="s1">&#39;call_duration&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>call_type</th>
      <th>call_duration</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 02:08:03.895999908+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>incoming</td>
      <td>1079</td>
      <td>2020-01-09 02:08:03.895999908+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:49:44.969000101+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578531e+09</td>
      <td>outgoing</td>
      <td>174</td>
      <td>2020-01-09 02:49:44.969000101+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:22:57.168999910+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>outgoing</td>
      <td>890</td>
      <td>2020-01-09 02:22:57.168999910+02:00</td>
    </tr>
    <tr>
      <th>2019-08-08 22:32:25.256999969+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565293e+09</td>
      <td>incoming</td>
      <td>1217</td>
      <td>2019-08-08 22:32:25.256999969+03:00</td>
    </tr>
    <tr>
      <th>2019-08-08 22:53:35.107000113+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565294e+09</td>
      <td>incoming</td>
      <td>383</td>
      <td>2019-08-08 22:53:35.107000113+03:00</td>
    </tr>
    <tr>
      <th>2019-08-08 22:31:34.539999962+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565293e+09</td>
      <td>incoming</td>
      <td>1142</td>
      <td>2019-08-08 22:31:34.539999962+03:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Sometimes the data may come in a disordered manner, so just to make sure, let’s order the dataframe and compare the results. We will use the columns “user” and “datetime” since we would like to order the information according to firstly, participants, and then, by time in order of happening. Luckily, in our dataframe, the index and datetime are the same.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="s1">&#39;call_duration&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>call_type</th>
      <th>call_duration</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-08 22:31:34.539999962+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565293e+09</td>
      <td>incoming</td>
      <td>1142</td>
      <td>2019-08-08 22:31:34.539999962+03:00</td>
    </tr>
    <tr>
      <th>2019-08-08 22:32:25.256999969+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565293e+09</td>
      <td>incoming</td>
      <td>1217</td>
      <td>2019-08-08 22:32:25.256999969+03:00</td>
    </tr>
    <tr>
      <th>2019-08-08 22:43:45.834000111+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
      <td>1.565293e+09</td>
      <td>incoming</td>
      <td>1170</td>
      <td>2019-08-08 22:43:45.834000111+03:00</td>
    </tr>
    <tr>
      <th>2020-01-09 01:55:16.996000051+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>outgoing</td>
      <td>1256</td>
      <td>2020-01-09 01:55:16.996000051+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:06:09.790999889+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>outgoing</td>
      <td>271</td>
      <td>2020-01-09 02:06:09.790999889+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:08:03.895999908+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>incoming</td>
      <td>1079</td>
      <td>2020-01-09 02:08:03.895999908+02:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>By comparing the last two dataframes, we can see that sorting the values was a good move. For example, in the unsorted dataframe, the earliest date for the user <em>iGyXetHE3S8u</em> was 2019-08-08 22:32:25; instead, for the sorted dataframe, the earliest date for the user <em>iGyXetHE3S8u</em> is 2019-08-08 22:31:34. Small differences, but still important.</p>
</section>
<section id="*-TIP!-Data-format-requirements-(or-what-should-our-data-look-like)">
<h2>* TIP! Data format requirements (or what should our data look like)<a class="headerlink" href="#*-TIP!-Data-format-requirements-(or-what-should-our-data-look-like)" title="Link to this heading"></a></h2>
<p>Data can take other shapes and formats. However, the <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> data scheme requires it to be in a certain shape. This means the dataframe needs to have at least the following characteristics:</p>
<ol class="arabic simple">
<li><p>One row per call. Each row should store information about one call only</p></li>
<li><p>Each row’s index should be a timestamp</p></li>
<li><p>There should be at least four columns:</p>
<ul class="simple">
<li><p>index: date and time when the event happened (timestamp)</p></li>
<li><p>user: stores the user name whose data is analyzed. Each user should have a unique name or hash (i.e. one hash for each unique user)</p></li>
<li><p>call_type: stores whether the call was incoming, outgoing, or missed. The exact words <em>incoming</em>, <em>outgoing</em>, and <em>missed</em> should be used</p></li>
<li><p>call_duration: the duration of the call in seconds</p></li>
</ul>
</li>
<li><p>Columns additional to those listed in item 3 are allowed</p></li>
<li><p>The names of the columns do not need to be exactly “user”, “call_type” or “call_duration” as we can pass our own names in an argument (to be explained later).</p></li>
</ol>
<p>Below is an example of a dataframe that complies with these minimum requirements</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_dataschema</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="s1">&#39;call_type&#39;</span><span class="p">,</span><span class="s1">&#39;call_duration&#39;</span><span class="p">]]</span>
<span class="n">example_dataschema</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>call_type</th>
      <th>call_duration</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-08 22:31:34.539999962+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>incoming</td>
      <td>1142</td>
    </tr>
    <tr>
      <th>2019-08-08 22:32:25.256999969+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>incoming</td>
      <td>1217</td>
    </tr>
    <tr>
      <th>2019-08-08 22:43:45.834000111+03:00</th>
      <td>iGyXetHE3S8u</td>
      <td>incoming</td>
      <td>1170</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="4.-Extracting-features">
<h2>4. Extracting features<a class="headerlink" href="#4.-Extracting-features" title="Link to this heading"></a></h2>
<p>There are two ways to extract features. We could use each function separately or we could use <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s ready-made wrapper. Both ways will require us to specify arguments to pass to the functions/wrapper in order to customize the way the functions work. These arguments are specified in dictionaries. Let’s first understand how to extract features using stand-alone functions.</p>
<section id="4.1-Extract-features-using-stand-alone-functions">
<h3>4.1 Extract features using stand-alone functions<a class="headerlink" href="#4.1-Extract-features-using-stand-alone-functions" title="Link to this heading"></a></h3>
<p>We can use <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s functions to compute communication features. Each function will require two inputs:</p>
<ul class="simple">
<li><p>(mandatory) dataframe that must comply with the minimum requirements (see ‘* TIP! Data requirements above)</p></li>
<li><p>(optional) arguments for stand-alone functions</p></li>
</ul>
<section id="4.1.1-The-argument-dictionary-for-stand-alone-functions-(or-how-we-specify-the-way-a-function-works)">
<h4>4.1.1 The argument dictionary for stand-alone functions (or how we specify the way a function works)<a class="headerlink" href="#4.1.1-The-argument-dictionary-for-stand-alone-functions-(or-how-we-specify-the-way-a-function-works)" title="Link to this heading"></a></h4>
<p>We can input two types of arguments to customize the way a stand-alone function works:</p>
<ul class="simple">
<li><p>the name of the columns to be preprocessed: Since the dataframe may have different columns, we need to specify which column has the data we would like to be preprocessed. To do so, we can simply pass the name of the column to the argument <code class="docutils literal notranslate"><span class="pre">communication_column_name</span></code>.</p></li>
<li><p>the way we resample: resampling options are specified in <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> as a dictionary. <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s resampling and aggregating relies on <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.resample</span></code>, so mastering the use of this pandas function will help us greatly in <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s preprocessing. Please familiarize yourself with the pandas resample function before continuing. Briefly, to use the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.resample</span></code> function, we need a rule. This rule states the intervals we would like to use to resample our data
(e.g., 15-seconds, 30-minutes, 1-hour). Neverthless, we can input more details into the function to specify the exact sampling we would like. For example, we could use the <em>close</em> argument if we would like to specify which side of the interval is closed, or we could use the <em>offset</em> argument if we would like to start our binning with an offset, etc. There are plenty of options to use this command, so we strongly recommend having <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.resample</span></code> documentation at hand. All
features for the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.resample</span></code> will be specified in a dictionary where keys are the arguments’ names for the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame.resample</span></code>, and the dictionary’s values are the values for each of these selected arguments. This dictionary will be passed as a value to the key <code class="docutils literal notranslate"><span class="pre">resample_args</span></code> in <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>.</p></li>
</ul>
<p>Let’s see some basic examples of these dictionaries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s2">&quot;call_duration&quot;</span><span class="p">,</span> <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">})</span>
<span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s2">&quot;random_name&quot;</span><span class="p">,</span> <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;30T&quot;</span><span class="p">})</span>
<span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s2">&quot;other_name&quot;</span><span class="p">,</span> <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;45T&quot;</span><span class="p">,</span><span class="s2">&quot;origin&quot;</span><span class="p">:</span><span class="s2">&quot;end&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>Here, we have basic feature function calls.</p>
<ul class="simple">
<li><p>The first example will analyze the data stored in the column <code class="docutils literal notranslate"><span class="pre">call_duration</span></code> in our dataframe. The data will be binned in one day periods</p></li>
<li><p>The second example will analyze the data stored in the column <code class="docutils literal notranslate"><span class="pre">random_name</span></code> in our dataframe. The data will be aggregated in 30-minutes bins</p></li>
<li><p>The third example will analyze the data stored in the column <code class="docutils literal notranslate"><span class="pre">other_name</span></code> in our dataframe. The data will be binned in 45-minutes bins, but the binning will start from the last timestamp in the dataframe.</p></li>
</ul>
<p><strong>Default values:</strong> if no arguments are passed, <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s default values are “call_duration” for the communication_column_name, and 30-min aggregation bins.</p>
</section>
<section id="4.1.2-Using-the-functions">
<h4>4.1.2 Using the functions<a class="headerlink" href="#4.1.2-Using-the-functions" title="Link to this heading"></a></h4>
<p>Now that we understand how the functions are customized, it is time we compute our first communication feature. Suppose that we are interested in extracting the total duration of outgoing calls every 20 minutes. We will need <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s <code class="docutils literal notranslate"><span class="pre">call_duration_total</span></code> function, the data, and we will also need to create a dictionary to customize our function. Let’s create the dictionary first</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_call_duration</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s1">&#39;call_duration&#39;</span><span class="p">,</span> <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rule&#39;</span><span class="p">:</span><span class="s1">&#39;20T&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Let’s look at some values for one of the subjects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_call_duration</span><span class="p">[</span><span class="n">my_call_duration</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;jd9INuQ5BBlW&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>missed_duration_total</th>
      <th>incoming_duration_total</th>
      <th>outgoing_duration_total</th>
      <th>user</th>
      <th>device</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 01:40:00+02:00</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1256.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:00:00+02:00</th>
      <td>0.0</td>
      <td>1079.0</td>
      <td>2192.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:20:00+02:00</th>
      <td>0.0</td>
      <td>4650.0</td>
      <td>3696.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:40:00+02:00</th>
      <td>0.0</td>
      <td>645.0</td>
      <td>174.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 03:00:00+02:00</th>
      <td>0.0</td>
      <td>269.0</td>
      <td>0.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Let’s remember how the original data looked like for this subject</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;jd9INuQ5BBlW&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>call_type</th>
      <th>call_duration</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 01:55:16.996000051+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>outgoing</td>
      <td>1256</td>
      <td>2020-01-09 01:55:16.996000051+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:06:09.790999889+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>outgoing</td>
      <td>271</td>
      <td>2020-01-09 02:06:09.790999889+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:08:03.895999908+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578528e+09</td>
      <td>incoming</td>
      <td>1079</td>
      <td>2020-01-09 02:08:03.895999908+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:10:06.573999882+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>missed</td>
      <td>0</td>
      <td>2020-01-09 02:10:06.573999882+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:11:37.648999929+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>outgoing</td>
      <td>1070</td>
      <td>2020-01-09 02:11:37.648999929+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:12:31.164000034+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>outgoing</td>
      <td>851</td>
      <td>2020-01-09 02:12:31.164000034+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:21:45.877000093+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578529e+09</td>
      <td>incoming</td>
      <td>1489</td>
      <td>2020-01-09 02:21:45.877000093+02:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We see that the bins are indeed 20-minutes bins, however, they are adjusted to fixed, predetermined intervals, i.e. the bin does not start on the time of the first datapoint. Instead, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> starts the binning at 00:00:00 of everyday and counts 20-minutes intervals from there.</p>
<p>If we want the binning to start from the first datapoint in our dataset, we need the origin parameter and a for loop.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">(</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">user</span><span class="p">],</span>
        <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s2">&quot;call_duration&quot;</span><span class="p">,</span>
        <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;20T&quot;</span><span class="p">,</span><span class="s2">&quot;origin&quot;</span><span class="p">:</span><span class="n">start_time</span><span class="p">}</span>
    <span class="p">))</span>
<span class="n">my_call_duration</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_call_duration</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>missed_duration_total</th>
      <th>incoming_duration_total</th>
      <th>outgoing_duration_total</th>
      <th>user</th>
      <th>device</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-09 07:11:34.539999962+03:00</th>
      <td>0.0</td>
      <td>0</td>
      <td>1322.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>2019-08-09 07:31:34.539999962+03:00</th>
      <td>0.0</td>
      <td>1034</td>
      <td>959.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>2019-08-09 07:51:34.539999962+03:00</th>
      <td>0.0</td>
      <td>921</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>2019-08-09 08:11:34.539999962+03:00</th>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>2019-08-09 08:31:34.539999962+03:00</th>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-08-09 06:51:34.539999962+03:00</th>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
      <td>Cq9vueHh3zVs</td>
    </tr>
    <tr>
      <th>2020-01-09 01:55:16.996000051+02:00</th>
      <td>0.0</td>
      <td>1079</td>
      <td>3448.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:15:16.996000051+02:00</th>
      <td>0.0</td>
      <td>1897</td>
      <td>3078.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:35:16.996000051+02:00</th>
      <td>0.0</td>
      <td>3398</td>
      <td>792.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
    <tr>
      <th>2020-01-09 02:55:16.996000051+02:00</th>
      <td>0.0</td>
      <td>269</td>
      <td>0.0</td>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
    </tr>
  </tbody>
</table>
<p>319 rows × 5 columns</p>
</div></div>
</div>
</section>
</section>
<section id="4.2-Extract-features-using-the-wrapper">
<h3>4.2 Extract features using the wrapper<a class="headerlink" href="#4.2-Extract-features-using-the-wrapper" title="Link to this heading"></a></h3>
<p>We can use <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s ready-made wrapper to extract one or several features at the same time. The wrapper will require two inputs:</p>
<ul class="simple">
<li><p>(mandatory) dataframe that must comply with the minimum requirements (see ‘* TIP! Data requirements above)</p></li>
<li><p>(optional) an argument dictionary for wrapper</p></li>
</ul>
<section id="4.2.1-The-argument-dictionary-for-wrapper-(or-how-we-specify-the-way-the-wrapper-works)">
<h4>4.2.1 The argument dictionary for wrapper (or how we specify the way the wrapper works)<a class="headerlink" href="#4.2.1-The-argument-dictionary-for-wrapper-(or-how-we-specify-the-way-the-wrapper-works)" title="Link to this heading"></a></h4>
<p>The argument dictionary contains the arguments for each stand-alone function we would like to employ. Its keys are the feature functions we want to compute. Its values are argument dictionaries created for each stand-alone function we will employ. Let’s see some examples of wrapper dictionaries:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features1</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_count</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper_features1</span></code> will be used to analyze two features, <code class="docutils literal notranslate"><span class="pre">call_duration_total</span></code> and <code class="docutils literal notranslate"><span class="pre">call_count</span></code>. For the feature call_duration_total, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">call_duration</span></code> in our dataframe and the data will be binned in one day periods. For the feature call_count, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">call_duration</span></code> in our dataframe and the data will be binned in one day periods.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features2</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_mean</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;random_name&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_duration_median</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;random_name&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;5H&quot;</span><span class="p">,</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span><span class="s2">&quot;5min&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper_features2</span></code> will be used to analyze two features, <code class="docutils literal notranslate"><span class="pre">call_duration_mean</span></code> and <code class="docutils literal notranslate"><span class="pre">call_duration_median</span></code>. For the feature call_duration_mean, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">random_name</span></code> in our dataframe and the data will be binned in one day periods. For the feature call_duration_median, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">random_name</span></code> in our dataframe and the data will be binned in 5-hour periods with a 5-minute offset.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features3</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;one_name&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">,</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span><span class="s2">&quot;5min&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_count</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;one_name&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;5H&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_duration_mean</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;another_name&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;30T&quot;</span><span class="p">,</span><span class="s2">&quot;origin&quot;</span><span class="p">:</span><span class="s2">&quot;end_day&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper_features3</span></code> will be used to analyze three features, <code class="docutils literal notranslate"><span class="pre">call_duration_total</span></code>, <code class="docutils literal notranslate"><span class="pre">call_count</span></code>, and <code class="docutils literal notranslate"><span class="pre">call_duration_mean</span></code>. For the feature call_duration_total, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">one_name</span></code> and the data will be binned in one day periods with a 5-min offset. For the feature call_count, we will use the data stored in the column <code class="docutils literal notranslate"><span class="pre">one_name</span></code> in our dataframe and the data will be binned in 5-hour periods. Finally, for the feature call_duration_mean, we will use
the data stored in the column <code class="docutils literal notranslate"><span class="pre">another_name</span></code> in our dataframe and the data will be binned in 30-minute periods and the origin of the bins will be the ceiling midnight of the last day.</p></li>
</ul>
<p><strong>Default values:</strong> if no arguments are passed, <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s default values are “call_duration” for the communication_column_name, and 30-min aggregation bins. Moreover, the wrapper will compute all the available functions in absence of the argument dictionary.</p>
</section>
<section id="4.2.2-Using-the-wrapper">
<h4>4.2.2 Using the wrapper<a class="headerlink" href="#4.2.2-Using-the-wrapper" title="Link to this heading"></a></h4>
<p>Now that we understand how the wrapper is customized, it is time we compute our first communication feature using the wrapper. Suppose that we are interested in extracting the call total duration every 20 minutes. We will need <code class="docutils literal notranslate"><span class="pre">niimpy</span></code>’s <code class="docutils literal notranslate"><span class="pre">extract_features_comms</span></code> function, the data, and we will also need to create a dictionary to customize our function. Let’s create the dictionary first</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features1</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;20T&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<p>Now let’s use the wrapper</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_wrapper</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">extract_features_comms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">wrapper_features1</span><span class="p">)</span>
<span class="n">results_wrapper</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
computing &lt;function call_duration_total at 0x7429d6675f80&gt;...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>missed_duration_total</th>
      <th>incoming_duration_total</th>
      <th>outgoing_duration_total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 01:40:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1256.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:00:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>1079.0</td>
      <td>2192.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:20:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>4650.0</td>
      <td>3696.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:40:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>645.0</td>
      <td>174.0</td>
    </tr>
    <tr>
      <th>2019-08-09 07:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1322.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Our first attempt was succesful. Now, let’s try something more. Let’s assume we want to compute the call_duration and call_count in 20-minutes bin.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features2</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_total</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;20T&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_count</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;20T&quot;</span><span class="p">}}}</span>
<span class="n">results_wrapper</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">extract_features_comms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">wrapper_features2</span><span class="p">)</span>
<span class="n">results_wrapper</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
computing &lt;function call_duration_total at 0x7429d6675f80&gt;...
computing &lt;function call_count at 0x7429d6676200&gt;...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>missed_duration_total</th>
      <th>incoming_duration_total</th>
      <th>outgoing_duration_total</th>
      <th>outgoing_count</th>
      <th>incoming_count</th>
      <th>missed_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 01:40:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1256.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:00:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>1079.0</td>
      <td>2192.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:20:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>4650.0</td>
      <td>3696.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2020-01-09 02:40:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>645.0</td>
      <td>174.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2019-08-09 07:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1322.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Great! Another successful attempt. We see from the results that more columns were added with the required calculations. This is how the wrapper works when all features are computed with the same bins. Now, let’s see how the wrapper performs when each function has different binning requirements. Let’s assume we need to compute the call_duration_mean every day, and the call_duration_median every 5 hours with an offset of 5 minutes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wrapper_features3</span> <span class="o">=</span> <span class="p">{</span><span class="n">com</span><span class="o">.</span><span class="n">call_duration_mean</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;1D&quot;</span><span class="p">}},</span>
                     <span class="n">com</span><span class="o">.</span><span class="n">call_duration_median</span><span class="p">:{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;call_duration&quot;</span><span class="p">,</span><span class="s2">&quot;resample_args&quot;</span><span class="p">:{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;5H&quot;</span><span class="p">,</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span><span class="s2">&quot;5min&quot;</span><span class="p">}}}</span>
<span class="n">results_wrapper</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">extract_features_comms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">wrapper_features3</span><span class="p">)</span>
<span class="n">results_wrapper</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
computing &lt;function call_duration_mean at 0x7429d6676020&gt;...
computing &lt;function call_duration_median at 0x7429d66760c0&gt;...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>missed_duration_mean</th>
      <th>outgoing_duration_mean</th>
      <th>incoming_duration_mean</th>
      <th>incoming_duration_median</th>
      <th>outgoing_duration_median</th>
      <th>missed_duration_median</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 00:00:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>731.8</td>
      <td>949.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-09 00:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>1140.5</td>
      <td>651.666667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-10 00:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>1363.0</td>
      <td>1298.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-11 00:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-12 00:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>209.0</td>
      <td>715.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_wrapper</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>missed_duration_mean</th>
      <th>outgoing_duration_mean</th>
      <th>incoming_duration_mean</th>
      <th>incoming_duration_median</th>
      <th>outgoing_duration_median</th>
      <th>missed_duration_median</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-12 09:05:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2019-08-12 14:05:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2019-08-12 19:05:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>715.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2019-08-13 00:05:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2019-08-13 05:05:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>591.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The output is once again a dataframe. In this case, two aggregations are shown. The first one is the daily aggregation computed for the <code class="docutils literal notranslate"><span class="pre">call_duration_mean</span></code> feature (head). The second one is the 5-hour aggregation period with 5-min offset for the <code class="docutils literal notranslate"><span class="pre">call_duration_median</span></code> (tail). We must note that because the <code class="docutils literal notranslate"><span class="pre">call_duration_median</span></code>feature is not required to be aggregated daily, the daily aggregation timestamps have a NaN value. Similarly, because the <code class="docutils literal notranslate"><span class="pre">call_duration_mean</span></code>is not required
to be aggregated in 5-hour windows, its values are NaN for all subjects.</p>
</section>
<section id="4.2.3-Wrapper-and-its-default-option">
<h4>4.2.3 Wrapper and its default option<a class="headerlink" href="#4.2.3-Wrapper-and-its-default-option" title="Link to this heading"></a></h4>
<p>The default option will compute all features in 30-minute aggregation windows. To use the <code class="docutils literal notranslate"><span class="pre">extract_features_comms</span></code> function with its default options, simply call the function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">extract_features_comms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
computing &lt;function call_duration_total at 0x7429d6675f80&gt;...
computing &lt;function call_duration_mean at 0x7429d6676020&gt;...
computing &lt;function call_duration_median at 0x7429d66760c0&gt;...
computing &lt;function call_duration_std at 0x7429d6676160&gt;...
computing &lt;function call_count at 0x7429d6676200&gt;...
computing &lt;function call_outgoing_incoming_ratio at 0x7429d66762a0&gt;...
computing &lt;function call_distribution at 0x7429d6676340&gt;...
computing &lt;function message_count at 0x7429d66763e0&gt;...
computing &lt;function message_outgoing_incoming_ratio at 0x7429d6676480&gt;...
computing &lt;function message_distribution at 0x7429d6676520&gt;...
</pre></div></div>
</div>
<p>The function prints the computed features so you can track its process. Now let’s have a look at the outputs</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>missed_duration_total</th>
      <th>incoming_duration_total</th>
      <th>outgoing_duration_total</th>
      <th>missed_duration_mean</th>
      <th>outgoing_duration_mean</th>
      <th>incoming_duration_mean</th>
      <th>incoming_duration_median</th>
      <th>outgoing_duration_median</th>
      <th>missed_duration_median</th>
      <th>missed_duration_std</th>
      <th>outgoing_duration_std</th>
      <th>incoming_duration_std</th>
      <th>outgoing_count</th>
      <th>incoming_count</th>
      <th>missed_count</th>
      <th>outgoing_incoming_ratio</th>
      <th>distribution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 01:30:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1256.0</td>
      <td>0.0</td>
      <td>1256.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>1256.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>inf</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2020-01-09 02:00:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>2976.0</td>
      <td>5270.0</td>
      <td>0.0</td>
      <td>752.857143</td>
      <td>992.000000</td>
      <td>1079.0</td>
      <td>851.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>443.087060</td>
      <td>545.726122</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.333333</td>
      <td>0.888889</td>
    </tr>
    <tr>
      <th>2020-01-09 02:30:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>jd9INuQ5BBlW</td>
      <td>0.0</td>
      <td>3398.0</td>
      <td>792.0</td>
      <td>0.0</td>
      <td>396.000000</td>
      <td>1132.666667</td>
      <td>1264.0</td>
      <td>396.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>313.955411</td>
      <td>437.058730</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.666667</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-09 07:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1322.0</td>
      <td>0.0</td>
      <td>1322.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>1322.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>inf</td>
      <td>0.833333</td>
    </tr>
    <tr>
      <th>2019-08-09 07:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0.0</td>
      <td>1824.0</td>
      <td>959.0</td>
      <td>0.0</td>
      <td>959.000000</td>
      <td>912.000000</td>
      <td>912.0</td>
      <td>959.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>172.534055</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.500000</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="4.3-SMS-computations">
<h3>4.3 SMS computations<a class="headerlink" href="#4.3-SMS-computations" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">niimpy</span></code> includes one function to count the outgoing and incoming SMS. This function is not automatically called by <code class="docutils literal notranslate"><span class="pre">extract_features_comms</span></code>, but it can be used as a standalone. Let’s see a quick example where we will upload the SMS data and preprocess it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">niimpy</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">MULTIUSER_AWARE_MESSAGES_PATH</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>device</th>
      <th>time</th>
      <th>message_type</th>
      <th>datetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 02:34:46.644999981+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578530e+09</td>
      <td>incoming</td>
      <td>2020-01-09 02:34:46.644999981+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:34:58.802999973+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578530e+09</td>
      <td>outgoing</td>
      <td>2020-01-09 02:34:58.802999973+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:35:37.611000061+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578530e+09</td>
      <td>outgoing</td>
      <td>2020-01-09 02:35:37.611000061+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:55:40.640000105+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578531e+09</td>
      <td>outgoing</td>
      <td>2020-01-09 02:55:40.640000105+02:00</td>
    </tr>
    <tr>
      <th>2020-01-09 02:55:50.914000034+02:00</th>
      <td>jd9INuQ5BBlW</td>
      <td>3p83yASkOb_B</td>
      <td>1.578531e+09</td>
      <td>incoming</td>
      <td>2020-01-09 02:55:50.914000034+02:00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sms</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">message_count</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;communication_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;message_type&quot;</span><span class="p">,</span> <span class="s2">&quot;call_type_column&quot;</span><span class="p">:</span> <span class="s2">&quot;message_type&quot;</span><span class="p">})</span>
<span class="n">sms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>outgoing_count</th>
      <th>incoming_count</th>
      <th>user</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-09 02:30:00+02:00</th>
      <td>3p83yASkOb_B</td>
      <td>5</td>
      <td>5.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
    <tr>
      <th>2019-08-13 08:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>1</td>
      <td>1.0</td>
      <td>iGyXetHE3S8u</td>
    </tr>
    <tr>
      <th>2019-08-13 09:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>0</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
    </tr>
    <tr>
      <th>2019-08-13 09:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>2</td>
      <td>1.0</td>
      <td>iGyXetHE3S8u</td>
    </tr>
    <tr>
      <th>2019-08-13 10:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>0</td>
      <td>0.0</td>
      <td>iGyXetHE3S8u</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-01-09 12:00:00+02:00</th>
      <td>OWd1Uau8POix</td>
      <td>0</td>
      <td>0.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
    <tr>
      <th>2020-01-09 12:30:00+02:00</th>
      <td>OWd1Uau8POix</td>
      <td>0</td>
      <td>3.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
    <tr>
      <th>2020-01-09 13:00:00+02:00</th>
      <td>OWd1Uau8POix</td>
      <td>0</td>
      <td>0.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
    <tr>
      <th>2020-01-09 13:30:00+02:00</th>
      <td>OWd1Uau8POix</td>
      <td>0</td>
      <td>0.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
    <tr>
      <th>2020-01-09 14:00:00+02:00</th>
      <td>OWd1Uau8POix</td>
      <td>2</td>
      <td>6.0</td>
      <td>jd9INuQ5BBlW</td>
    </tr>
  </tbody>
</table>
<p>114 rows × 4 columns</p>
</div></div>
</div>
<p>Similar to the calls functions, we need to define the <code class="docutils literal notranslate"><span class="pre">config</span></code> dictionary. Likewise, if we leave it empty, then all data is aggregated in 30-minutes bins. We see that the function also differentiates between the incoming and outgoing messages. Let’s quickly summarize the data requirements for SMS</p>
</section>
</section>
<section id="*-TIP!-Data-format-requirements-for-SMS-(special-case)">
<h2>* TIP! Data format requirements for SMS (special case)<a class="headerlink" href="#*-TIP!-Data-format-requirements-for-SMS-(special-case)" title="Link to this heading"></a></h2>
<p>Data can take other shapes and formats. However, the <code class="docutils literal notranslate"><span class="pre">niimpy</span></code> data scheme requires it to be in a certain shape. This means the dataframe needs to have at least the following characteristics:</p>
<ol class="arabic simple">
<li><p>One row per call. Each row should store information about one call only</p></li>
<li><p>Each row’s index should be a timestamp</p></li>
<li><p>There should be at least four columns:</p>
<ul class="simple">
<li><p>index: date and time when the event happened (timestamp)</p></li>
<li><p>user: stores the user name whose data is analyzed. Each user should have a unique name or hash (i.e. one hash for each unique user)</p></li>
<li><p>message_type: determines if the message was sent (outgoing) or received (incoming)</p></li>
</ul>
</li>
<li><p>Columns additional to those listed in item 3 are allowed</p></li>
<li><p>The names of the columns do not need to be exactly “user”, “message_type”</p></li>
</ol>
</section>
<section id="5.-Implementing-own-features">
<h2>5. Implementing own features<a class="headerlink" href="#5.-Implementing-own-features" title="Link to this heading"></a></h2>
<p>If none of the provided functions suits well, We can implement our own customized features easily. To do so, we need to define a function that accepts a dataframe and returns a dataframe. The returned object should be indexed by user and timestamps (multiindex). Let’s assume we need a new function that counts all calls, independent of their direction (outgoing, incoming, etc.). Let’s first define the function</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">call_count_all</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">communication_column_name</span> <span class="o">=</span> <span class="s2">&quot;call_duration&quot;</span><span class="p">,</span> <span class="n">resample_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span><span class="s2">&quot;30T&quot;</span><span class="p">}):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">])[</span><span class="n">communication_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="o">**</span><span class="n">resample_args</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;call_count_all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reset_index</span><span class="p">([</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<p>Then, we can call our new function in the stand-alone way or using the <code class="docutils literal notranslate"><span class="pre">extract_features_comms</span></code> function. Because the stand-alone way is the common way to call functions in python, we will not show it. Instead, we will show how to integrate this new function to the wrapper. Let’s read again the data and assume we want the default behavior of the wrapper.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">niimpy</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">MULTIUSER_AWARE_CALLS_PATH</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>
<span class="n">customized_features</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">extract_features_comms</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">{</span><span class="n">call_count_all</span><span class="p">:</span> <span class="p">{}})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
computing &lt;function call_count_all at 0x742b0b54a980&gt;...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">customized_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>device</th>
      <th>user</th>
      <th>call_count_all</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-08-08 22:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2019-08-08 23:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2019-08-08 23:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2019-08-09 00:00:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2019-08-09 00:30:00+03:00</th>
      <td>Cq9vueHh3zVs</td>
      <td>iGyXetHE3S8u</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../battery/" class="btn btn-neutral float-left" title="Battery Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../screen/" class="btn btn-neutral float-right" title="Screen On/Off Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, the contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>